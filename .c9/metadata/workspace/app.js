{"filter":false,"title":"app.js","tooltip":"/app.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":88,"column":27},"end":{"row":88,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":89,"column":25},"end":{"row":89,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":90,"column":25},"end":{"row":90,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":91,"column":29},"end":{"row":91,"column":30}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":90,"column":25},"end":{"row":90,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":89,"column":25},"end":{"row":89,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":88,"column":27},"end":{"row":88,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":87,"column":27},"end":{"row":87,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":86,"column":27},"end":{"row":86,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":85,"column":24},"end":{"row":85,"column":25}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":84,"column":30},"end":{"row":84,"column":31}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":83,"column":25},"end":{"row":83,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":83,"column":25},"end":{"row":83,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":84,"column":30},"end":{"row":84,"column":31}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":85,"column":24},"end":{"row":85,"column":25}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":27},"end":{"row":86,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":27},"end":{"row":87,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":88,"column":27},"end":{"row":88,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":89,"column":25},"end":{"row":89,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":90,"column":25},"end":{"row":90,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":91,"column":29},"end":{"row":91,"column":30}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":92,"column":33},"end":{"row":92,"column":34}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":93,"column":27},"end":{"row":93,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":94,"column":28},"end":{"row":94,"column":29}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":95,"column":26},"end":{"row":95,"column":27}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":96,"column":26},"end":{"row":96,"column":27}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":97,"column":23},"end":{"row":97,"column":24}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":98,"column":34},"end":{"row":98,"column":35}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":99,"column":36},"end":{"row":99,"column":37}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":27},"end":{"row":100,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":101,"column":27},"end":{"row":101,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":102,"column":26},"end":{"row":102,"column":27}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":36},"end":{"row":103,"column":37}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":32},"end":{"row":104,"column":33}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":105,"column":36},"end":{"row":105,"column":37}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":28},"end":{"row":106,"column":29}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":107,"column":34},"end":{"row":107,"column":35}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":108,"column":35},"end":{"row":108,"column":36}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":110,"column":3},"end":{"row":111,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":111,"column":0},"end":{"row":112,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":0},"end":{"row":112,"column":1}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":1},"end":{"row":112,"column":2}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":2},"end":{"row":112,"column":3}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":3},"end":{"row":112,"column":4}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":4},"end":{"row":112,"column":5}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":5},"end":{"row":112,"column":6}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":6},"end":{"row":112,"column":7}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":7},"end":{"row":112,"column":8}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":8},"end":{"row":112,"column":9}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":9},"end":{"row":112,"column":10}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":10},"end":{"row":112,"column":11}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":11},"end":{"row":112,"column":13}},"text":"()"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":12},"end":{"row":112,"column":15}},"text":"hl7"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":15},"end":{"row":112,"column":16}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":16},"end":{"row":112,"column":26}},"text":"SendingAPP"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":112,"column":27},"end":{"row":112,"column":28}},"text":";"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":80,"column":0},"end":{"row":80,"column":39}},"text":"console.log(message.query('PID|5[1]'));"},{"action":"removeLines","range":{"start":{"row":79,"column":0},"end":{"row":80,"column":0}},"nl":"\n","lines":["console.log(message.query('PID|5[0]'));"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":79,"column":0},"end":{"row":80,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":79,"column":0},"end":{"row":80,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":25},"end":{"row":109,"column":26}},"text":"P"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":24},"end":{"row":109,"column":25}},"text":"P"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":23},"end":{"row":109,"column":24}},"text":"A"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":22},"end":{"row":109,"column":23}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":21},"end":{"row":109,"column":22}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":20},"end":{"row":109,"column":21}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":19},"end":{"row":109,"column":20}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":18},"end":{"row":109,"column":19}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":17},"end":{"row":109,"column":18}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":16},"end":{"row":109,"column":17}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":15},"end":{"row":109,"column":16}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":149,"column":0},"end":{"row":149,"column":61}},"text":"        doc.pipe(fs.createWriteStream('./uploads/file.pdf'));"},{"action":"removeLines","range":{"start":{"row":120,"column":0},"end":{"row":149,"column":0}},"nl":"\n","lines":["        borngender;","        if (req.body.PatientSex == \"M\") {","            patientgender = \"M.\";","            borngender = \"Né\";","        }","        else if (req.body.PatientSex == \"F\") {","            patientgender = \"Mme.\";","            borngender = \"Née\";","        }","        var doc = new PDFDocument();","        ","        doc.fontSize(14).text(req.body.SendingFacility).fontSize(10).text(req.body.FacilityStreetAdress).text(req.body.FacilityPostalCode + \" \" + req.body.FacilityCity).text(req.body.FacilityPhoneNumber).text('————————————————').fontSize(14).text('Dr ' + req.body.DoctorFname + \" \" + req.body.DoctorLname).fontSize(10).text('N° RPPS : ' + req.body.DoctorRPPS).fontSize(18).text(patientgender + \" \" + req.body.PatientFname + \" \" + req.body.PatientLname, {","            align: 'right'","        }).fontSize(12).text(borngender+' le ' + req.body.PatientDOB, {","            align: 'right'","        }).text(req.body.Facility + \" - Chambre \" + req.body.PatientRoom, {","            align: 'right'","        }).text('Séjour n° ' + req.body.PatientVisitNumber, {","            align: 'right'","        }).fontSize(10).moveDown().text(req.body.PatientStreet, {","            align: 'right'","        }).text(req.body.PatientPostalCode + \" \" + req.body.PatientCity, {","            align: 'right'","        }).text(req.body.PatientPhone, {","            align: 'right'","        }).moveDown(2).fontSize(12).text('Le, ' + req.body.PrescriptionDateTime).moveDown().fontSize(12).moveDown().text(req.body.PrescriptionText).moveDown(2).fontSize(8).text('Informations issues du logiciel ' + req.body.SendingAPP, {","            align: 'center'","        });","        doc.end();"]},{"action":"removeText","range":{"start":{"row":119,"column":7},"end":{"row":119,"column":26}},"text":" var patientgender,"},{"action":"removeText","range":{"start":{"row":119,"column":7},"end":{"row":120,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":110,"column":0},"end":{"row":110,"column":19}},"text":" var patientgender,"},{"action":"insertText","range":{"start":{"row":110,"column":19},"end":{"row":111,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":111,"column":0},"end":{"row":140,"column":0}},"lines":["        borngender;","        if (req.body.PatientSex == \"M\") {","            patientgender = \"M.\";","            borngender = \"Né\";","        }","        else if (req.body.PatientSex == \"F\") {","            patientgender = \"Mme.\";","            borngender = \"Née\";","        }","        var doc = new PDFDocument();","        ","        doc.fontSize(14).text(req.body.SendingFacility).fontSize(10).text(req.body.FacilityStreetAdress).text(req.body.FacilityPostalCode + \" \" + req.body.FacilityCity).text(req.body.FacilityPhoneNumber).text('————————————————').fontSize(14).text('Dr ' + req.body.DoctorFname + \" \" + req.body.DoctorLname).fontSize(10).text('N° RPPS : ' + req.body.DoctorRPPS).fontSize(18).text(patientgender + \" \" + req.body.PatientFname + \" \" + req.body.PatientLname, {","            align: 'right'","        }).fontSize(12).text(borngender+' le ' + req.body.PatientDOB, {","            align: 'right'","        }).text(req.body.Facility + \" - Chambre \" + req.body.PatientRoom, {","            align: 'right'","        }).text('Séjour n° ' + req.body.PatientVisitNumber, {","            align: 'right'","        }).fontSize(10).moveDown().text(req.body.PatientStreet, {","            align: 'right'","        }).text(req.body.PatientPostalCode + \" \" + req.body.PatientCity, {","            align: 'right'","        }).text(req.body.PatientPhone, {","            align: 'right'","        }).moveDown(2).fontSize(12).text('Le, ' + req.body.PrescriptionDateTime).moveDown().fontSize(12).moveDown().text(req.body.PrescriptionText).moveDown(2).fontSize(8).text('Informations issues du logiciel ' + req.body.SendingAPP, {","            align: 'center'","        });","        doc.end();"]},{"action":"insertText","range":{"start":{"row":140,"column":0},"end":{"row":140,"column":61}},"text":"        doc.pipe(fs.createWriteStream('./uploads/file.pdf'));"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":151,"column":0},"end":{"row":151,"column":7}},"text":"    });"},{"action":"removeLines","range":{"start":{"row":144,"column":0},"end":{"row":151,"column":0}},"nl":"\n","lines":["    app.post('/postprescriptiontxt', function(req, res) {","        console.log(req.body);","        // Need to escape \" in mirth in case","        res.send(200);","        // create PDF a document","       ",""]},{"action":"removeText","range":{"start":{"row":143,"column":3},"end":{"row":143,"column":53}},"text":" //used to receive the TXT prescription from mirth"},{"action":"removeText","range":{"start":{"row":143,"column":3},"end":{"row":144,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":0,"column":0},"end":{"row":145,"column":0}},"nl":"\n","lines":["var express = require(\"express\"),","    app = express(),","    mongoose = require('mongoose'),","    db = mongoose.connection,","    request = require(\"request\"),","    multer = require('multer'),","    bodyParser = require('body-parser'),","    PDFDocument = require('pdfkit'),","    fs = require('fs'),","    parser = require('L7');","","//Use for upload file","app.use(multer({","    dest: './uploads/'","}));","//use for parsing body data","app.use(bodyParser.urlencoded({","    extended: true","}));","app.use(bodyParser.json());","","","//add support for text/plain","app.use(function(req, res, next) {","    if (req.is('text/*')) {","        req.text = '';","        req.setEncoding('utf8');","        req.on('data', function(chunk) {","            req.text += chunk;","        });","        req.on('end', next);","    }","    else {","        next();","    }","});","app.listen(process.env.PORT, process.env.IP);","","//Start Mongoose","mongoose.connect(process.env.MONGOCON);","//DB open function","db.on('error', console.error.bind(console, 'mongodb connection error:'));","db.once('open', function callback() {","    console.log(\"DB Open\");","    //use to get the hl7 from mirth","    app.post('/posthl7', function(req, res) {","        console.log(req.text);","        res.send(200);","    });","    //use to post the file in body and the patient info in the header and forward it to mirth","    app.post('/postcr', function(req, res) {","        // console.log(req.files);","        // Forward to mirth","        console.log(req.headers.exam_infos);","","        request.post({","            url: 'http://146.148.3.248:80/crtxt/',","            body: req.headers.exam_infos,","            headers: {","                'Content-Type': 'text/plain'","            }","        }, function(error, response, body) {","            //HERE code to manage post errors","        });","        res.send(200);","    });","","    app.get('/hello', function(req, res) {","        //set the download name","        res.setHeader('Content-disposition', 'attachment; filename=dramaticpenguin.txt');","        // Send the datas ad a file","","    });","","    //use to receive the HL7 prescription and forward it to mirth","    app.post('/postprescriptionhl7', function(req, res) {","        //forward to mirth","        console.log(req.text);","       var message = parser.parse(req.text);","var hl7 = message.translate({","    SendingAPP: \"MSH|3^1\",","    SendingFacility: \"MSH|4^0\",","    PatientID: \"PID|3^0\",","    PatientFname: \"PID|5^1\",","    PatientLname: \"PID|5^0\",","    PatientBname: \"PID|6^0\",","    PatientDOB: \"PID|7^0\",","    PatientSex: \"PID|8^0\",","    PatientStreet: \"PID|11^0\",","    PatientPostalCode: \"PID|11^2\",","    PatientCity: \"PID|11^4\",","    PatientPhone: \"PID|13^0\",","    Pointofcare: \"PV1|3^0\",","    PatientRoom: \"PV1|3^1\",","    Facility: \"PV1|3^3\",","    PatientVisitNumber: \"PV1|19^0\",","    PatientAdmitTimeDate: \"PV1|44^0\",","    DoctorLname: \"ORC|12^1\",","    DoctorFname: \"ORC|12^2\",","    DoctorRPPS: \"ORC|12^0\",","    PrescriptionDateTime: \"ORC|15^0\",","    PrescriptionText: \"ORC|16^1\",","    FacilityStreetAdress: \"ORC|22^0\",","    FacilityCity: \"ORC|22^2\",","    FacilityPostalCode: \"ORC|22^4\",","    FacilityPhoneNumber: \"ORC|23^0\",","    PrescriptionExam: \"OBR|4^1\"","});","","console.log(hl7);"," var patientgender,","        borngender;","        if (req.body.PatientSex == \"M\") {","            patientgender = \"M.\";","            borngender = \"Né\";","        }","        else if (req.body.PatientSex == \"F\") {","            patientgender = \"Mme.\";","            borngender = \"Née\";","        }","        var doc = new PDFDocument();","        ","        doc.fontSize(14).text(req.body.SendingFacility).fontSize(10).text(req.body.FacilityStreetAdress).text(req.body.FacilityPostalCode + \" \" + req.body.FacilityCity).text(req.body.FacilityPhoneNumber).text('————————————————').fontSize(14).text('Dr ' + req.body.DoctorFname + \" \" + req.body.DoctorLname).fontSize(10).text('N° RPPS : ' + req.body.DoctorRPPS).fontSize(18).text(patientgender + \" \" + req.body.PatientFname + \" \" + req.body.PatientLname, {","            align: 'right'","        }).fontSize(12).text(borngender+' le ' + req.body.PatientDOB, {","            align: 'right'","        }).text(req.body.Facility + \" - Chambre \" + req.body.PatientRoom, {","            align: 'right'","        }).text('Séjour n° ' + req.body.PatientVisitNumber, {","            align: 'right'","        }).fontSize(10).moveDown().text(req.body.PatientStreet, {","            align: 'right'","        }).text(req.body.PatientPostalCode + \" \" + req.body.PatientCity, {","            align: 'right'","        }).text(req.body.PatientPhone, {","            align: 'right'","        }).moveDown(2).fontSize(12).text('Le, ' + req.body.PrescriptionDateTime).moveDown().fontSize(12).moveDown().text(req.body.PrescriptionText).moveDown(2).fontSize(8).text('Informations issues du logiciel ' + req.body.SendingAPP, {","            align: 'center'","        });","        doc.end();","        doc.pipe(fs.createWriteStream('./uploads/file.pdf'));","        res.send(200);","    });","   ","});"]},{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":33}},"text":"var express = require(\"express\"),"},{"action":"insertText","range":{"start":{"row":0,"column":33},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":145,"column":0}},"lines":["    app = express(),","    mongoose = require('mongoose'),","    db = mongoose.connection,","    request = require(\"request\"),","    multer = require('multer'),","    bodyParser = require('body-parser'),","    PDFDocument = require('pdfkit'),","    fs = require('fs'),","    parser = require('L7');","","//Use for upload file","app.use(multer({","    dest: './uploads/'","}));","//use for parsing body data","app.use(bodyParser.urlencoded({","    extended: true","}));","app.use(bodyParser.json());","","","//add support for text/plain","app.use(function(req, res, next) {","    if (req.is('text/*')) {","        req.text = '';","        req.setEncoding('utf8');","        req.on('data', function(chunk) {","            req.text += chunk;","        });","        req.on('end', next);","    }","    else {","        next();","    }","});","app.listen(process.env.PORT, process.env.IP);","","//Start Mongoose","mongoose.connect(process.env.MONGOCON);","//DB open function","db.on('error', console.error.bind(console, 'mongodb connection error:'));","db.once('open', function callback() {","    console.log(\"DB Open\");","    //use to get the hl7 from mirth","    app.post('/posthl7', function(req, res) {","        console.log(req.text);","        res.send(200);","    });","    //use to post the file in body and the patient info in the header and forward it to mirth","    app.post('/postcr', function(req, res) {","        // console.log(req.files);","        // Forward to mirth","        console.log(req.headers.exam_infos);","","        request.post({","            url: 'http://146.148.3.248:80/crtxt/',","            body: req.headers.exam_infos,","            headers: {","                'Content-Type': 'text/plain'","            }","        }, function(error, response, body) {","            //HERE code to manage post errors","        });","        res.send(200);","    });","","    app.get('/hello', function(req, res) {","        //set the download name","        res.setHeader('Content-disposition', 'attachment; filename=dramaticpenguin.txt');","        // Send the datas ad a file","","    });","","    //use to receive the HL7 prescription and forward it to mirth","    app.post('/postprescriptionhl7', function(req, res) {","        //forward to mirth","        console.log(req.text);","        var message = parser.parse(req.text);","        var hl7 = message.translate({","            SendingAPP: \"MSH|3^1\",","            SendingFacility: \"MSH|4^0\",","            PatientID: \"PID|3^0\",","            PatientFname: \"PID|5^1\",","            PatientLname: \"PID|5^0\",","            PatientBname: \"PID|6^0\",","            PatientDOB: \"PID|7^0\",","            PatientSex: \"PID|8^0\",","            PatientStreet: \"PID|11^0\",","            PatientPostalCode: \"PID|11^2\",","            PatientCity: \"PID|11^4\",","            PatientPhone: \"PID|13^0\",","            Pointofcare: \"PV1|3^0\",","            PatientRoom: \"PV1|3^1\",","            Facility: \"PV1|3^3\",","            PatientVisitNumber: \"PV1|19^0\",","            PatientAdmitTimeDate: \"PV1|44^0\",","            DoctorLname: \"ORC|12^1\",","            DoctorFname: \"ORC|12^2\",","            DoctorRPPS: \"ORC|12^0\",","            PrescriptionDateTime: \"ORC|15^0\",","            PrescriptionText: \"ORC|16^1\",","            FacilityStreetAdress: \"ORC|22^0\",","            FacilityCity: \"ORC|22^2\",","            FacilityPostalCode: \"ORC|22^4\",","            FacilityPhoneNumber: \"ORC|23^0\",","            PrescriptionExam: \"OBR|4^1\"","        });","","        console.log(hl7);","        var patientgender,","        borngender;","        if (req.body.PatientSex == \"M\") {","            patientgender = \"M.\";","            borngender = \"Né\";","        }","        else if (req.body.PatientSex == \"F\") {","            patientgender = \"Mme.\";","            borngender = \"Née\";","        }","        var doc = new PDFDocument();","","        doc.fontSize(14).text(req.body.SendingFacility).fontSize(10).text(req.body.FacilityStreetAdress).text(req.body.FacilityPostalCode + \" \" + req.body.FacilityCity).text(req.body.FacilityPhoneNumber).text('————————————————').fontSize(14).text('Dr ' + req.body.DoctorFname + \" \" + req.body.DoctorLname).fontSize(10).text('N° RPPS : ' + req.body.DoctorRPPS).fontSize(18).text(patientgender + \" \" + req.body.PatientFname + \" \" + req.body.PatientLname, {","            align: 'right'","        }).fontSize(12).text(borngender + ' le ' + req.body.PatientDOB, {","            align: 'right'","        }).text(req.body.Facility + \" - Chambre \" + req.body.PatientRoom, {","            align: 'right'","        }).text('Séjour n° ' + req.body.PatientVisitNumber, {","            align: 'right'","        }).fontSize(10).moveDown().text(req.body.PatientStreet, {","            align: 'right'","        }).text(req.body.PatientPostalCode + \" \" + req.body.PatientCity, {","            align: 'right'","        }).text(req.body.PatientPhone, {","            align: 'right'","        }).moveDown(2).fontSize(12).text('Le, ' + req.body.PrescriptionDateTime).moveDown().fontSize(12).moveDown().text(req.body.PrescriptionText).moveDown(2).fontSize(8).text('Informations issues du logiciel ' + req.body.SendingAPP, {","            align: 'center'","        });","        doc.end();","        doc.pipe(fs.createWriteStream('./uploads/file.pdf'));","        res.send(200);","    });","","});"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":109,"column":25},"end":{"row":110,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":110,"column":0},"end":{"row":110,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":15},"end":{"row":79,"column":16}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":16},"end":{"row":79,"column":17}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":17},"end":{"row":79,"column":18}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":18},"end":{"row":79,"column":19}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":19},"end":{"row":79,"column":20}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":20},"end":{"row":79,"column":21}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":21},"end":{"row":79,"column":22}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":15},"end":{"row":79,"column":16}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":15},"end":{"row":79,"column":16}},"text":"M"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":21},"end":{"row":79,"column":22}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":20},"end":{"row":79,"column":21}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":19},"end":{"row":79,"column":20}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":18},"end":{"row":79,"column":19}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":17},"end":{"row":79,"column":18}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":16},"end":{"row":79,"column":17}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":15},"end":{"row":79,"column":16}},"text":"M"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":15},"end":{"row":79,"column":16}},"text":"J"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":16},"end":{"row":79,"column":17}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":17},"end":{"row":79,"column":18}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":18},"end":{"row":79,"column":19}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":109,"column":20},"end":{"row":109,"column":23}},"text":"hl7"},{"action":"insertText","range":{"start":{"row":109,"column":20},"end":{"row":109,"column":27}},"text":"hl7Json"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":9},"end":{"row":121,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":121,"column":0},"end":{"row":121,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":121,"column":8},"end":{"row":122,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":122,"column":0},"end":{"row":122,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":61},"end":{"row":144,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":144,"column":0},"end":{"row":144,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":144,"column":8},"end":{"row":145,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":145,"column":0},"end":{"row":145,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":113,"column":12},"end":{"row":113,"column":20}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":113,"column":12},"end":{"row":113,"column":19}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":117,"column":17},"end":{"row":117,"column":25}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":117,"column":17},"end":{"row":117,"column":24}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":30},"end":{"row":125,"column":38}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":30},"end":{"row":125,"column":37}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":73},"end":{"row":125,"column":81}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":73},"end":{"row":125,"column":80}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":108},"end":{"row":125,"column":116}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":108},"end":{"row":125,"column":115}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":143},"end":{"row":125,"column":151}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":143},"end":{"row":125,"column":150}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":170},"end":{"row":125,"column":178}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":170},"end":{"row":125,"column":177}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":250},"end":{"row":125,"column":258}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":250},"end":{"row":125,"column":257}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":278},"end":{"row":125,"column":286}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":278},"end":{"row":125,"column":285}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":332},"end":{"row":125,"column":340}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":332},"end":{"row":125,"column":339}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":392},"end":{"row":125,"column":400}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":392},"end":{"row":125,"column":399}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":125,"column":421},"end":{"row":125,"column":429}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":125,"column":421},"end":{"row":125,"column":428}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":127,"column":51},"end":{"row":127,"column":59}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":127,"column":51},"end":{"row":127,"column":58}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":129,"column":16},"end":{"row":129,"column":24}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":129,"column":16},"end":{"row":129,"column":23}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":129,"column":51},"end":{"row":129,"column":59}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":129,"column":51},"end":{"row":129,"column":58}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":131,"column":31},"end":{"row":131,"column":39}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":131,"column":31},"end":{"row":131,"column":38}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":133,"column":40},"end":{"row":133,"column":48}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":133,"column":40},"end":{"row":133,"column":47}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":135,"column":16},"end":{"row":135,"column":24}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":135,"column":16},"end":{"row":135,"column":23}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":135,"column":50},"end":{"row":135,"column":58}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":135,"column":50},"end":{"row":135,"column":57}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":137,"column":16},"end":{"row":137,"column":24}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":137,"column":16},"end":{"row":137,"column":23}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":139,"column":50},"end":{"row":139,"column":58}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":139,"column":50},"end":{"row":139,"column":57}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":139,"column":120},"end":{"row":139,"column":128}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":139,"column":120},"end":{"row":139,"column":127}},"text":"hl7Json"},{"action":"removeText","range":{"start":{"row":139,"column":212},"end":{"row":139,"column":220}},"text":"req.body"},{"action":"insertText","range":{"start":{"row":139,"column":212},"end":{"row":139,"column":219}},"text":"hl7Json"}]}]]},"ace":{"folds":[],"scrolltop":1676,"scrollleft":0,"selection":{"start":{"row":142,"column":18},"end":{"row":142,"column":18},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":115,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1406673324188,"hash":"74a1123776b06c1bf91b768646aa0ec620174043"}